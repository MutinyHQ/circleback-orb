description: >
  This job triggers a pipeline in a separate project via the CircleCI API.

executor: default

parameters:
  circleci_api_key:
    type: env_var_name
    default: CIRCLECI_API_KEY
    description: "The name of the environment variable that contains the CircleCI API key."
  circle_workflow_id:
    type: env_var_name
    default: CIRCLE_WORKFLOW_ID
    description: "The name of the environment variable that contains the CircleCI workflow ID."
  project:
    type: string
    description: "The name of the project to trigger."
  branch:
    type: string
    default: main
    description: "The branch to trigger the pipeline on."
  parameters:
    type: string
    default: '{}'
    description: "The JSON data to send to the CircleCI API."
steps:
  - checkout
  - circleback-orb/trigger:
      project: <<parameters.project>>
      branch: <<parameters.branch>>
      parameters: <<parameters.parameters>>
      circleci_api_key: <<parameters.circleci_api_key>>
      circle_workflow_id: <<parameters.circle_workflow_id>>
  - circleback-orb/check_status:
      project: <<parameters.project>>
      circleci_api_key: <<parameters.circleci_api_key>>
      circle_workflow_id: <<parameters.circle_workflow_id>>
      poll: true
